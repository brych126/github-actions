name: Run DB Integration Tests

on:
  workflow_dispatch:

jobs:
  db-tests:
    runs-on: ubuntu-latest
    # services:
    #   mssql:
    #     image: mcr.microsoft.com/mssql/server:2022-latest
    #     ports:
    #       - 1433:1433
    #     env:
    #       ACCEPT_EULA: "Y"
    #       SA_PASSWORD: "Password1"
    #     options: >-
    #       -v ${{ github.workspace }}/DatabaseTests/scripts:/scripts:ro
    #       --health-cmd="/opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P Password1 -Q 'SELECT 1' -C"
    #       --health-interval=30s
    #       --health-timeout=10s
    #       --health-retries=3

    steps:
      - name: List docker containers
        run: |
         docker ps --format "{{.Names}}"
         docker ps -q --filter "ancestor=mcr.microsoft.com/mssql/server:2022-latest"

      - uses: actions/checkout@v4

      - name: ls
        run: |
         ls -R ${{ github.workspace }}

      # - name: Check mounted dir
      #   run: docker exec -it $(docker ps -q --filter "ancestor=mcr.microsoft.com/mssql/server:2022-latest") ls /scripts