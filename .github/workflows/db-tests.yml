name: Run DB Integration Tests

on:
  workflow_dispatch:

jobs:
  db-tests:
    runs-on: ubuntu-latest
    services:
      mssql:
        image: mcr.microsoft.com/mssql/server:2022-latest
        ports:
          - 1433:1433
        env:
          ACCEPT_EULA: "Y"
          SA_PASSWORD: "Password1"
        options: >-
          --health-cmd="/opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P Password1 -Q 'SELECT 1' -C"
          --health-interval=30s
          --health-timeout=10s
          --health-retries=3

    steps:
      - name: List docker containers
        run: docker ps --format "{{.Names}}"